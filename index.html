<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RED System - NBA Team Season Performance</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0a0e1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #C9A84C;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #e0c766;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #0a0e1a;
            color: #e0e0e0;
            line-height: 1.6;
            overflow-x: hidden;
        }

        header {
            background: linear-gradient(135deg, #141929 0%, #1a1f2e 100%);
            border-bottom: 2px solid #C9A84C;
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            cursor: pointer;
        }

        .red-badge {
            font-size: 2rem;
            font-weight: 700;
            color: #C9A84C;
            background: rgba(201, 168, 76, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 2px solid #C9A84C;
            letter-spacing: 2px;
        }

        .header-title-text {
            display: flex;
            flex-direction: column;
        }

        .header-title-text h1 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
            margin: 0;
        }

        .header-title-text p {
            font-size: 0.75rem;
            color: #999;
            margin: 0.25rem 0 0 0;
            letter-spacing: 0.5px;
        }

        .header-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-box {
            background: #0a0e1a;
            border: 1px solid #C9A84C;
            padding: 0.7rem 1rem;
            border-radius: 6px;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            width: 250px;
            transition: all 0.3s ease;
        }

        .search-box:focus {
            outline: none;
            background: #141929;
            border-color: #e0c766;
            box-shadow: 0 0 12px rgba(201, 168, 76, 0.2);
        }

        .search-box::placeholder {
            color: #666;
        }

        .help-btn {
            background: #C9A84C;
            color: #0a0e1a;
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .help-btn:hover {
            background: #e0c766;
            transform: scale(1.05);
        }

        .disclaimer-banner {
            background: rgba(217, 119, 6, 0.15);
            border-left: 4px solid #f97316;
            padding: 1rem 1.5rem;
            margin: 2rem auto;
            max-width: 1400px;
            border-radius: 4px;
            font-size: 0.85rem;
            color: #ffd07a;
        }

        .disclaimer-banner strong {
            color: #ffd99d;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem 4rem 2rem;
        }

        .loading-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 400px;
            gap: 2rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #333;
            border-top: 4px solid #C9A84C;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-text {
            color: #999;
            font-size: 0.9rem;
            text-align: center;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .results-info {
            font-size: 0.9rem;
            color: #999;
        }

        .table-wrapper {
            overflow-x: auto;
            background: #141929;
            border-radius: 8px;
            border: 1px solid #2a2f3e;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #141929;
        }

        thead {
            background: linear-gradient(90deg, #1a1f2e 0%, #202636 100%);
            border-bottom: 2px solid #C9A84C;
        }

        th {
            padding: 1rem;
            text-align: left;
            font-weight: 600;
            color: #C9A84C;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
            transition: all 0.2s ease;
        }

        th:hover {
            background-color: rgba(201, 168, 76, 0.1);
        }

        .sort-indicator {
            display: inline-block;
            margin-left: 0.5rem;
            font-size: 0.75rem;
            color: #C9A84C;
        }

        td {
            padding: 1rem;
            border-bottom: 1px solid #1a1f2e;
            font-size: 0.9rem;
        }

        tbody tr {
            transition: all 0.2s ease;
            background: #141929;
        }

        tbody tr:hover {
            background: #1a202e;
            box-shadow: inset 0 0 20px rgba(201, 168, 76, 0.05);
        }

        tbody tr.filtered-out {
            display: none;
        }

        .rank-cell {
            font-weight: 700;
            width: 50px;
            text-align: center;
        }

        .rank-medal {
            margin-right: 0.5rem;
        }

        .team-badge {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .team-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.8rem;
            color: white;
            flex-shrink: 0;
        }

        .red-score {
            font-weight: 700;
            font-size: 1.1rem;
            padding: 0.5rem 0.8rem;
            border-radius: 4px;
            min-width: 60px;
            text-align: center;
        }

        .red-score.excellent {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }

        .red-score.good {
            background: rgba(134, 239, 172, 0.2);
            color: #86efac;
        }

        .red-score.neutral {
            background: rgba(148, 163, 184, 0.2);
            color: #cbd5e1;
        }

        .red-score.poor {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
        }

        .red-score.bad {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
        }

        .record-cell {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .stats-cell {
            text-align: center;
            color: #bbb;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: #141929;
            margin: 5% auto;
            padding: 2rem;
            border: 1px solid #C9A84C;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #C9A84C;
            padding-bottom: 1rem;
        }

        .modal-header h2 {
            color: #C9A84C;
            font-size: 1.5rem;
            margin: 0;
        }

        .close-btn {
            color: #C9A84C;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            color: #e0c766;
            transform: scale(1.2);
        }

        .modal-body {
            color: #e0e0e0;
            line-height: 1.8;
        }

        .modal-body h3 {
            color: #C9A84C;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
        }

        .modal-body p {
            margin-bottom: 1rem;
        }

        .modal-body code {
            background: #0a0e1a;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            color: #86efac;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .formula-box {
            background: #0a0e1a;
            border-left: 4px solid #C9A84C;
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #86efac;
            overflow-x: auto;
        }

        footer {
            background: linear-gradient(135deg, #0a0e1a 0%, #141929 100%);
            border-top: 2px solid #C9A84C;
            padding: 2rem;
            text-align: center;
            color: #999;
            font-size: 0.85rem;
            margin-top: 4rem;
        }

        footer a {
            color: #C9A84C;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        footer a:hover {
            color: #e0c766;
            text-decoration: underline;
        }

        .no-data {
            text-align: center;
            padding: 3rem;
            color: #999;
            font-size: 1rem;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.15);
            border-left: 4px solid #ef4444;
            padding: 1rem 1.5rem;
            margin: 2rem auto;
            max-width: 1400px;
            border-radius: 4px;
            color: #fca5a5;
        }

        @media (max-width: 1024px) {
            .search-box {
                width: 180px;
            }

            th, td {
                padding: 0.75rem;
                font-size: 0.8rem;
            }

            .red-score {
                font-size: 0.95rem;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                gap: 1rem;
            }

            .header-controls {
                width: 100%;
                justify-content: space-between;
            }

            .search-box {
                width: 100%;
                max-width: none;
            }

            .disclaimer-banner {
                margin: 1rem auto;
                padding: 0.8rem 1rem;
                font-size: 0.8rem;
            }

            .container {
                padding: 0 1rem 2rem 1rem;
            }

            th, td {
                padding: 0.6rem;
                font-size: 0.75rem;
            }

            table {
                font-size: 0.75rem;
            }

            .team-circle {
                width: 32px;
                height: 32px;
                font-size: 0.7rem;
            }

            .red-score {
                font-size: 0.85rem;
                padding: 0.4rem 0.6rem;
            }

            .modal-content {
                width: 95%;
                margin: 20% auto;
                padding: 1.5rem;
            }

            .team-badge {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.3rem;
            }

            .results-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media (max-width: 480px) {
            .red-badge {
                font-size: 1.5rem;
                padding: 0.3rem 0.6rem;
            }

            .header-title-text h1 {
                font-size: 0.95rem;
            }

            th, td {
                padding: 0.5rem;
                font-size: 0.7rem;
            }

            .team-circle {
                width: 28px;
                height: 28px;
                font-size: 0.6rem;
            }

            .red-score {
                font-size: 0.8rem;
                min-width: 50px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="header-title">
                <div class="red-badge">RED</div>
                <div class="header-title-text">
                    <h1>Rating of Elite Dominance</h1>
                    <p>NBA Team Season Performance ¬∑ 2025‚Äì26 Live</p>
                </div>
            </div>
            <div class="header-controls">
                <input type="text" class="search-box" id="searchBox" placeholder="Search team or coach...">
                <button class="help-btn" id="helpBtn" title="How RED is calculated">?</button>
            </div>
        </div>
    </header>

    <!-- ‚îÄ‚îÄ Navigation ‚îÄ‚îÄ -->
    <nav style="background:#0f1420;border-bottom:1px solid #2a3040;padding:0 2rem;">
        <div style="max-width:1200px;margin:0 auto;display:flex;align-items:center;gap:0;overflow-x:auto;">
            <span style="font-size:0.72rem;color:#666;letter-spacing:1px;text-transform:uppercase;white-space:nowrap;margin-right:16px;padding:12px 0;">RED System</span>
            <a href="https://redcoachingstat.github.io/RED/" style="display:inline-block;padding:10px 18px;font-size:0.82rem;font-weight:600;color:#C9A84C;text-decoration:none;border-bottom:2px solid #C9A84C;white-space:nowrap;font-family:inherit;">2025‚Äì26 Live</a>
            <a href="https://redcoachingstat.github.io/RED/all/" style="display:inline-block;padding:10px 18px;font-size:0.82rem;font-weight:600;color:#888;text-decoration:none;border-bottom:2px solid transparent;white-space:nowrap;transition:all 0.2s;font-family:inherit;" onmouseover="this.style.color='#C9A84C';this.style.borderBottomColor='#C9A84C'" onmouseout="this.style.color='#888';this.style.borderBottomColor='transparent'">All Seasons &#8594;</a>
            <span style="flex:1"></span>
        </div>
    </nav>

    <div class="disclaimer-banner">
        <strong>RED ‚Äî Mid-Season Edition:</strong> 70% overall performance (wins above .500 pace) + 30% Pythagorean efficiency. Rates how dominant a team is relative to what their stats predict. Descriptive only ‚Äî not predictive.
    </div>

    <div class="container">
        <div id="loadingContainer" class="loading-container">
            <div class="spinner"></div>
            <p class="progress-text">Initializing RED System...</p>
            <p class="progress-text" id="progressText">Loading 0/30 teams...</p>
        </div>

        <div id="resultsContainer" style="display: none;">
            <div class="results-header">
                <div class="results-info">
                    <strong id="teamCount">0</strong> teams ¬∑ 2025‚Äì26 season ¬∑ <span id="dataTimestamp"></span>
                </div>
                <div style="display:flex;align-items:center;gap:12px;">
                    <span id="nextRefreshLabel" style="display:none;"></span>
                    <button id="refreshBtn" onclick="manualRefresh()" style="background:transparent;color:#666;border:1px solid #333;padding:5px 12px;border-radius:6px;cursor:pointer;font-size:0.75rem;font-family:inherit;transition:all 0.2s;" onmouseover="this.style.borderColor='#C9A84C';this.style.color='#C9A84C'" onmouseout="this.style.borderColor='#333';this.style.color='#666'">‚ü≥</button>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="leaderboardTable">
                    <thead>
                        <tr>
                            <th class="sortable" data-sort="rank">Rank</th>
                            <th class="sortable" data-sort="team">Team</th>
                            <th class="sortable" data-sort="coach">Coach</th>
                            <th class="sortable" data-sort="red">RED Score</th>
                            <th class="sortable" data-sort="red-per-game">RED/G</th>
                            <th class="sortable" data-sort="record">Record</th>
                            <th class="sortable" data-sort="games">GP</th>
                        </tr>
                    </thead>
                    <tbody id="leaderboardBody">
                    </tbody>
                </table>
            </div>
            <div id="noDataMessage" class="no-data" style="display: none;">
                No teams match your search criteria.
            </div>
        </div>
    </div>

    <div id="helpModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>How RED Works</h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <p>
                    <strong>RED (Rating of Elite Dominance)</strong> is a team season performance metric. It measures how dominant a team truly is ‚Äî combining their record relative to league-average with how efficiently they convert scoring margin into wins.
                </p>

                <h3>The Core Idea</h3>
                <p>
                    Every team has a "true" performance level hidden in their scoring margins. A team outscoring opponents by 8 points per game should be winning at a very high rate. If they're not, something is off ‚Äî whether that's poor clutch play, bad luck, or other factors. If they're winning even more than their margin predicts, they're doing something special.
                </p>
                <p>
                    RED captures exactly that gap ‚Äî using only <strong>current season data</strong>. No preseason projections. No roster rankings. Just: how does this team's actual record compare to what their point differential says it should be? This makes RED naturally era-neutral, so teams from different decades can be fairly compared.
                </p>

                <h3>The Formula</h3>
                <strong>Two components, blended 70/30:</strong>
                <div class="formula-box">
(A) Quality Score = Actual Wins ‚àí (Games Played √ó 0.5)
    ‚Üí How many wins above league-average pace?

(B) Efficiency Score = Actual Wins ‚àí Pythagorean Expected Wins
    Pythagorean Win% = PtsFor¬π¬≥¬∑‚Åπ¬π √∑ (PtsFor¬π¬≥¬∑‚Åπ¬π + PtsAgainst¬π¬≥¬∑‚Åπ¬π)
    ‚Üí Winning more games than scoring margin predicts?

RED = (0.70 √ó Quality) + (0.30 √ó Efficiency)
                </div>

                <h3>Interpretation</h3>
                <p>
                    <strong>Positive RED:</strong> Team is winning above league-average pace and/or converting their scoring margin into wins efficiently. Truly dominant teams score highest regardless of era.
                </p>
                <p>
                    <strong>Negative RED:</strong> Team is below .500 pace and/or underperforming their point differential. Poor results regardless of talent level.
                </p>
                <p>
                    <strong>The efficiency signal:</strong> The Pythagorean component (30%) rewards teams squeezing extra wins beyond what their raw scoring says they deserve ‚Äî like a defense-first team winning tight games, or a unit that peaks in clutch moments.
                </p>

                <h3>Why this blend?</h3>
                <p>
                    Pure Pythagorean has a flaw: a team getting blown out every night but squeaking out a few surprise wins scores <em>positive</em> RED, because their terrible differential predicts almost zero wins. The 70% quality weight anchors scores to real performance ‚Äî good teams rank high, bad teams rank low ‚Äî while the efficiency component still captures genuine coaching edge.
                </p>

                <h3>Notes</h3>
                <ul style="margin-left: 1.5rem; margin-bottom: 1rem;">
                    <li>RED is <strong>descriptive</strong> ‚Äî it describes what happened, not what will happen</li>
                    <li>Uses live ESPN standings data; falls back to All-Star break snapshot if unavailable</li>
                    <li>Updated each time the page is loaded</li>
                </ul>
            </div>
        </div>
    </div>

    <footer>
        <p>
            <strong>Data Sources:</strong> ESPN API (live standings + points data) ¬∑ Fallback: compiled records as of 2026 All-Star break
        </p>
        <p style="margin-top: 0.5rem;">
            RED is a descriptive analytical metric. Not recommended for gambling or financial decisions.
        </p>
    </footer>

    <script>
        // Static Data
        // No preseason data needed. RED is now 100% based on current season performance.

        const ESPN_TEAMS = [
            { id: "1",  name: "Atlanta Hawks",          abbr: "ATL", coach: "Quin Snyder", color: "#E03C21" },
            { id: "2",  name: "Boston Celtics",         abbr: "BOS", coach: "Joe Mazzulla", color: "#007A33" },
            { id: "17", name: "Brooklyn Nets",          abbr: "BKN", coach: "Jordi Fernandez", color: "#000000" },
            { id: "30", name: "Charlotte Hornets",      abbr: "CHA", coach: "Charles Lee", color: "#00778D" },
            { id: "4",  name: "Chicago Bulls",          abbr: "CHI", coach: "Billy Donovan", color: "#CE1141" },
            { id: "5",  name: "Cleveland Cavaliers",    abbr: "CLE", coach: "Kenny Atkinson", color: "#6F2DA8" },
            { id: "6",  name: "Dallas Mavericks",       abbr: "DAL", coach: "Jason Kidd", color: "#002B81" },
            { id: "7",  name: "Denver Nuggets",         abbr: "DEN", coach: "David Adelman", color: "#0E2240" },
            { id: "8",  name: "Detroit Pistons",        abbr: "DET", coach: "J.B. Bickerstaff", color: "#C8102E" },
            { id: "9",  name: "Golden State Warriors",  abbr: "GSW", coach: "Steve Kerr", color: "#1D428A" },
            { id: "10", name: "Houston Rockets",        abbr: "HOU", coach: "Ime Udoka", color: "#CE1141" },
            { id: "11", name: "Indiana Pacers",         abbr: "IND", coach: "Rick Carlisle", color: "#002D58" },
            { id: "12", name: "Los Angeles Clippers",   abbr: "LAC", coach: "Tyronn Lue", color: "#C60C30" },
            { id: "13", name: "Los Angeles Lakers",     abbr: "LAL", coach: "JJ Redick", color: "#552583" },
            { id: "29", name: "Memphis Grizzlies",      abbr: "MEM", coach: "Tuomas Iisalo", color: "#12173F" },
            { id: "14", name: "Miami Heat",             abbr: "MIA", coach: "Erik Spoelstra", color: "#98002E" },
            { id: "15", name: "Milwaukee Bucks",        abbr: "MIL", coach: "Doc Rivers", color: "#12173F" },
            { id: "16", name: "Minnesota Timberwolves", abbr: "MIN", coach: "Chris Finch", color: "#0C2B4C" },
            { id: "3",  name: "New Orleans Pelicans",   abbr: "NOP", coach: "James Borrego (interim)", color: "#0C2340" },
            { id: "18", name: "New York Knicks",        abbr: "NYK", coach: "Mike Brown", color: "#F58426" },
            { id: "25", name: "Oklahoma City Thunder",  abbr: "OKC", coach: "Mark Daigneault", color: "#007AC1" },
            { id: "19", name: "Orlando Magic",          abbr: "ORL", coach: "Jamahl Mosley", color: "#0077B6" },
            { id: "20", name: "Philadelphia 76ers",     abbr: "PHI", coach: "Nick Nurse", color: "#1D1160" },
            { id: "21", name: "Phoenix Suns",           abbr: "PHX", coach: "Jordan Ott", color: "#1D1160" },
            { id: "22", name: "Portland Trail Blazers", abbr: "POR", coach: "Chauncey Billups", color: "#E03C21" },
            { id: "23", name: "Sacramento Kings",       abbr: "SAC", coach: "Doug Christie", color: "#5A2D81" },
            { id: "24", name: "San Antonio Spurs",      abbr: "SAS", coach: "Mitch Johnson", color: "#C4CED4" },
            { id: "28", name: "Toronto Raptors",        abbr: "TOR", coach: "Darko Rajakovic", color: "#CE1141" },
            { id: "26", name: "Utah Jazz",              abbr: "UTA", coach: "Will Hardy", color: "#002B5C" },
            { id: "27", name: "Washington Wizards",     abbr: "WAS", coach: "Brian Keefe", color: "#002B5C" }
        ];

        // ‚îÄ‚îÄ Preseason Expected Wins (2025-26 Vegas consensus / media projections) ‚îÄ‚îÄ
        // These represent what each team was projected to win BEFORE the season started,
        // based on preseason odds & roster assessment. This is the "roster quality" baseline.
        // Beating this = coach is outperforming their talent level.
        // Note: Boston's 54W projection assumes a healthy Jayson Tatum. His Achilles injury
        // means Mazzulla's 37-19 is a dramatic overperformance of adjusted expectations.
        // DOM Elements
        const loadingContainer = document.getElementById('loadingContainer');
        const resultsContainer = document.getElementById('resultsContainer');
        const leaderboardBody = document.getElementById('leaderboardBody');
        const searchBox = document.getElementById('searchBox');
        const helpBtn = document.getElementById('helpBtn');
        const helpModal = document.getElementById('helpModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const progressText = document.getElementById('progressText');
        const noDataMessage = document.getElementById('noDataMessage');
        const dataTimestamp = document.getElementById('dataTimestamp');
        const teamCount = document.getElementById('teamCount');

        let allResults = [];
        let currentSort = { column: 'red', direction: 'desc' };

        // Helper Functions
        function formatDate(date) {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const month = String(now.getMonth() + 1).padStart(2, '0');
            return `${now.getFullYear()}-${month}-${day} ${hours}:${minutes} UTC`;
        }

        // ‚îÄ‚îÄ Fallback standings (~Feb 22, 2026) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // W-L: sourced from confirmed public reporting (power rankings, game logs).
        // Key confirmed: OKC 44-14, SAS 40-16, DET ~40-15, BOS 37-19,
        //   NYK 37-21, HOU 35-21, TOR 34-21, PHX 33-25, SAC 13-46.
        // PPG / OPPG: estimated from team style + confirmed point differentials.
        const FALLBACK_RECORDS = {
            // Team                              W    L      PF      PA
            "Oklahoma City Thunder":  { wins: 44, losses: 14, ptsFor: 118.8, ptsAgainst: 107.4 },
            "San Antonio Spurs":      { wins: 40, losses: 16, ptsFor: 118.2, ptsAgainst: 108.8 },
            "Detroit Pistons":        { wins: 40, losses: 15, ptsFor: 113.2, ptsAgainst: 103.8 },
            "Boston Celtics":         { wins: 37, losses: 19, ptsFor: 119.8, ptsAgainst: 111.6 },
            "New York Knicks":        { wins: 37, losses: 21, ptsFor: 115.2, ptsAgainst: 109.8 },
            "Cleveland Cavaliers":    { wins: 36, losses: 22, ptsFor: 116.4, ptsAgainst: 111.8 },
            "Houston Rockets":        { wins: 35, losses: 21, ptsFor: 117.1, ptsAgainst: 112.2 },
            "Toronto Raptors":        { wins: 34, losses: 21, ptsFor: 114.6, ptsAgainst: 110.4 },
            "Phoenix Suns":           { wins: 33, losses: 25, ptsFor: 114.8, ptsAgainst: 112.4 },
            "Los Angeles Clippers":   { wins: 32, losses: 25, ptsFor: 113.6, ptsAgainst: 111.8 },
            "Denver Nuggets":         { wins: 31, losses: 26, ptsFor: 116.2, ptsAgainst: 113.8 },
            "Los Angeles Lakers":     { wins: 30, losses: 27, ptsFor: 115.8, ptsAgainst: 114.4 },
            "Minnesota Timberwolves": { wins: 29, losses: 28, ptsFor: 113.2, ptsAgainst: 112.6 },
            "Golden State Warriors":  { wins: 29, losses: 28, ptsFor: 116.8, ptsAgainst: 116.2 },
            "Dallas Mavericks":       { wins: 28, losses: 29, ptsFor: 113.4, ptsAgainst: 114.8 },
            "Milwaukee Bucks":        { wins: 27, losses: 30, ptsFor: 114.2, ptsAgainst: 115.8 },
            "Memphis Grizzlies":      { wins: 26, losses: 31, ptsFor: 114.8, ptsAgainst: 116.5 },
            "Miami Heat":             { wins: 25, losses: 32, ptsFor: 111.8, ptsAgainst: 113.9 },
            "Orlando Magic":          { wins: 25, losses: 32, ptsFor: 109.6, ptsAgainst: 111.8 },
            "Philadelphia 76ers":     { wins: 24, losses: 33, ptsFor: 112.1, ptsAgainst: 115.4 },
            "New Orleans Pelicans":   { wins: 22, losses: 35, ptsFor: 110.8, ptsAgainst: 115.2 },
            "Atlanta Hawks":          { wins: 21, losses: 36, ptsFor: 114.4, ptsAgainst: 118.6 },
            "Charlotte Hornets":      { wins: 18, losses: 39, ptsFor: 111.4, ptsAgainst: 118.2 },
            "Chicago Bulls":          { wins: 18, losses: 39, ptsFor: 110.6, ptsAgainst: 117.8 },
            "Indiana Pacers":         { wins: 16, losses: 41, ptsFor: 118.2, ptsAgainst: 124.6 },
            "Brooklyn Nets":          { wins: 16, losses: 41, ptsFor: 108.8, ptsAgainst: 118.2 },
            "Portland Trail Blazers": { wins: 15, losses: 42, ptsFor: 108.6, ptsAgainst: 117.6 },
            "Utah Jazz":              { wins: 13, losses: 44, ptsFor: 107.9, ptsAgainst: 120.1 },
            "Sacramento Kings":       { wins: 13, losses: 46, ptsFor: 107.6, ptsAgainst: 121.8 },
            "Washington Wizards":     { wins: 10, losses: 47, ptsFor: 105.8, ptsAgainst: 122.4 },
        };

        // ‚îÄ‚îÄ Single-call ESPN standings fetch (all 30 teams, one request) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        async function fetchAllStandings() {
            const url = 'https://site.api.espn.com/apis/v2/sports/basketball/nba/standings?season=2026';
            try {
                const res = await fetch(url, { cache: 'no-store' });
                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();

                const entries = data?.standings?.entries || [];
                if (entries.length < 28) throw new Error('Incomplete standings data');

                const records = {};
                for (const entry of entries) {
                    const name = entry.team?.displayName;
                    if (!name) continue;
                    const stats = entry.stats || [];

                    // Helper: find a stat by any of several possible field names ESPN uses
                    const get = (...keys) => {
                        for (const key of keys) {
                            const s = stats.find(s => s.name === key || s.abbreviation === key || s.shortDisplayName === key);
                            if (s) return parseFloat(s.value) || 0;
                        }
                        return 0;
                    };

                    const wins     = Math.round(get('wins',   'W'));
                    const losses   = Math.round(get('losses', 'L'));
                    // ESPN may expose avg points as 'pointsFor'/'pointsAgainst' or 'avgPoints'/'oppAvgPoints'
                    const ptsFor   = get('pointsFor', 'avgPoints',    'ppg',  'Points For');
                    const ptsAgainst = get('pointsAgainst', 'oppAvgPoints', 'oppg', 'Points Against');

                    records[name] = { wins, losses, ptsFor, ptsAgainst };
                }

                // If ESPN didn't return points data, pull it from our fallback
                for (const [team, rec] of Object.entries(records)) {
                    if (!rec.ptsFor && FALLBACK_RECORDS[team]) {
                        rec.ptsFor     = FALLBACK_RECORDS[team].ptsFor;
                        rec.ptsAgainst = FALLBACK_RECORDS[team].ptsAgainst;
                    }
                }

                console.log(`‚úÖ Live standings loaded for ${Object.keys(records).length} teams`);
                return { records, source: 'live' };
            } catch (err) {
                console.warn('Live standings failed ‚Äî using All-Star break fallback:', err.message);
                return { records: FALLBACK_RECORDS, source: 'fallback' };
            }
        }

        // ‚îÄ‚îÄ RED Calculation: Hybrid Quality + Pythagorean Efficiency ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        //
        // Problem with pure Pythagorean: bad teams that get blown out but somehow
        // win a few close games score POSITIVE RED (e.g. Wizards ranked #1). That's
        // because their terrible differential predicts almost zero wins, so any
        // actual wins look like coaching genius.
        //
        // Fix: blend two components ‚Äî
        //   (A) Quality Score   ‚Äî wins above league-average pace (.500)
        //                         captures overall team performance
        //   (B) Efficiency Score ‚Äî Pythagorean delta (wins above what PPG predicts)
        //                         captures coaching edge in close games / conversions
        //
        //   RED = 0.70 √ó Quality + 0.30 √ó Efficiency
        //
        // This way good teams rank high (dominated by quality), bad teams rank low,
        // and the Pythagorean component still rewards coaches squeezing out extra
        // wins vs their talent level ‚Äî e.g. Celtics overperforming without Tatum.
        //
        // Scale: roughly -15 (worst) to +15 (best) over a full season.
        // ‚îÄ‚îÄ RED Formula ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // RED = 0.70 √ó WinsAbove.500 + 0.30 √ó PythagoreanDelta
        //
        // WinsAbove.500: actual wins minus the league-neutral .500 pace.
        //   Every win above average reflects coaching output. A neutral baseline
        //   avoids penalising top teams for being expected to be good.
        //
        // PythagoreanDelta: actual wins minus wins predicted from point differential.
        //   Measures coaching decisions ‚Äî rotations, late-game management, clutch subs.
        //   A positive delta means winning close games more than the margin predicts.
        //
        // Scale: roughly ‚Äì15 (worst) to +15 (best) over a full season.
        function calculateRED(wins, losses, ptsFor, ptsAgainst) {
            const gamesPlayed = wins + losses;
            if (gamesPlayed === 0 || ptsFor === 0 || ptsAgainst === 0) {
                return { redScore: 0, gamesPlayed: 0, actualWins: wins,
                         actualLosses: losses, expectedWins: 0, redPerGame: 0 };
            }

            // (A) Wins above .500 pace
            const winsAboveAvg = wins - (gamesPlayed * 0.5);

            // (B) Pythagorean efficiency
            const EXP          = 13.91;
            const pfPow        = Math.pow(ptsFor,     EXP);
            const paPow        = Math.pow(ptsAgainst, EXP);
            const pythWinPct   = pfPow / (pfPow + paPow);
            const expectedWins = pythWinPct * gamesPlayed;
            const pythDelta    = wins - expectedWins;

            // Blend: quality dominates, efficiency adds nuance
            const redScore   = (0.70 * winsAboveAvg) + (0.30 * pythDelta);
            const redPerGame = redScore / gamesPlayed;

            return {
                redScore,
                gamesPlayed,
                actualWins:   wins,
                actualLosses: losses,
                expectedWins: parseFloat(expectedWins.toFixed(1)),
                redPerGame
            };
        }

        async function initializeSystem() {
            allResults = [];
            progressText.textContent = 'Fetching standings...';

            // One single API call for all 30 teams ‚Äî falls back to hardcoded data if it fails
            const { records, source } = await fetchAllStandings();

            for (const team of ESPN_TEAMS) {
                const rec = records[team.name];
                if (!rec) continue;
                if ((rec.wins + rec.losses) === 0) continue;

                const redData = calculateRED(
                    rec.wins, rec.losses, rec.ptsFor, rec.ptsAgainst
                );
                allResults.push({ ...team, ...redData });
            }

            // Show data source in timestamp
            const sourceLabel = source === 'live'
                ? 'Live data via ESPN'
                : 'Standings as of All-Star Break 2026 (fallback)';

            // Sort by RED score descending
            allResults.sort((a, b) => b.redScore - a.redScore);

            // Show results
            loadingContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            dataTimestamp.textContent = `${sourceLabel} ¬∑ ${formatDate(new Date())}`;
            teamCount.textContent = allResults.length;

            renderLeaderboard(allResults);
        }

        function getRedScoreClass(score) {
            if (score > 2.0) return 'excellent';
            if (score > 0.5) return 'good';
            if (score > -0.5) return 'neutral';
            if (score > -2.0) return 'poor';
            return 'bad';
        }

        function getRankMedal(rank) {
            if (rank === 1) return 'ü•á';
            if (rank === 2) return 'ü•à';
            if (rank === 3) return 'ü•â';
            return '';
        }

        function renderLeaderboard(data) {
            leaderboardBody.innerHTML = '';
            
            if (data.length === 0) {
                noDataMessage.style.display = 'block';
                return;
            } else {
                noDataMessage.style.display = 'none';
            }

            data.forEach((result, index) => {
                const rank = index + 1;
                const row = document.createElement('tr');

                const redScoreClass = getRedScoreClass(result.redScore);
                const medal = getRankMedal(rank);
                const record = `${result.actualWins}-${result.actualLosses}`;
                const redPerGameStr = (result.redPerGame >= 0 ? '+' : '') + result.redPerGame.toFixed(3);
                const redScoreStr   = (result.redScore   >= 0 ? '+' : '') + result.redScore.toFixed(2);

                row.innerHTML = `
                    <td class="rank-cell">
                        <span class="rank-medal">${medal}</span>${rank}
                    </td>
                    <td>
                        <div class="team-badge">
                            <div class="team-circle" style="background-color: ${result.color};">
                                ${result.abbr}
                            </div>
                            <span>${result.name}</span>
                        </div>
                    </td>
                    <td>${result.coach}</td>
                    <td>
                        <div class="red-score ${redScoreClass}">
                            ${redScoreStr}
                        </div>
                    </td>
                    <td class="stats-cell">${redPerGameStr}</td>
                    <td class="record-cell">${record}</td>
                    <td class="stats-cell">${result.gamesPlayed}</td>
                `;

                leaderboardBody.appendChild(row);
            });

            attachSortListeners();
        }

        function attachSortListeners() {
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', () => {
                    const column = th.dataset.sort;
                    
                    if (currentSort.column === column) {
                        currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
                    } else {
                        currentSort.column = column;
                        currentSort.direction = 'desc';
                    }

                    sortAndRender();
                    updateSortIndicators();
                });
            });

            updateSortIndicators();
        }

        function updateSortIndicators() {
            document.querySelectorAll('th.sortable .sort-indicator').forEach(el => el.remove());

            const sortHeader = document.querySelector(`th[data-sort="${currentSort.column}"]`);
            if (sortHeader) {
                const indicator = document.createElement('span');
                indicator.className = 'sort-indicator';
                indicator.textContent = currentSort.direction === 'asc' ? '‚Üë' : '‚Üì';
                sortHeader.appendChild(indicator);
            }
        }

        function sortAndRender() {
            const sorted = [...allResults].sort((a, b) => {
                let aVal, bVal;

                switch (currentSort.column) {
                    case 'rank':
                        aVal = allResults.indexOf(a);
                        bVal = allResults.indexOf(b);
                        break;
                    case 'team':
                        aVal = a.name.toLowerCase();
                        bVal = b.name.toLowerCase();
                        break;
                    case 'coach':
                        aVal = a.coach.toLowerCase();
                        bVal = b.coach.toLowerCase();
                        break;
                    case 'red':
                        aVal = a.redScore;
                        bVal = b.redScore;
                        break;
                    case 'red-per-game':
                        aVal = a.redPerGame;
                        bVal = b.redPerGame;
                        break;
                    case 'record':
                        aVal = a.actualWins;
                        bVal = b.actualWins;
                        break;
                    case 'games':
                        aVal = a.gamesPlayed;
                        bVal = b.gamesPlayed;
                        break;
                    default:
                        return 0;
                }

                if (typeof aVal === 'string') {
                    return currentSort.direction === 'asc' ? 
                        aVal.localeCompare(bVal) : 
                        bVal.localeCompare(aVal);
                }

                return currentSort.direction === 'asc' ? aVal - bVal : bVal - aVal;
            });

            renderLeaderboard(sorted);
        }

        function filterBySearch(query) {
            const lowerQuery = query.toLowerCase();
            const filtered = allResults.filter(result => 
                result.name.toLowerCase().includes(lowerQuery) ||
                result.coach.toLowerCase().includes(lowerQuery) ||
                result.abbr.toLowerCase().includes(lowerQuery)
            );

            renderLeaderboard(filtered);
        }

        // Event Listeners
        searchBox.addEventListener('input', (e) => {
            filterBySearch(e.target.value);
        });

        helpBtn.addEventListener('click', () => {
            helpModal.style.display = 'block';
        });

        closeModalBtn.addEventListener('click', () => {
            helpModal.style.display = 'none';
        });

        window.addEventListener('click', (e) => {
            if (e.target === helpModal) {
                helpModal.style.display = 'none';
            }
        });

        // ‚îÄ‚îÄ Auto-refresh every 20 minutes ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        const REFRESH_INTERVAL_MS = 20 * 60 * 1000; // 20 minutes
        let refreshTimer = null;
        let countdownTimer = null;
        let nextRefreshAt = null;

        const nextRefreshLabel = document.getElementById('nextRefreshLabel');

        function startCountdown() {
            if (countdownTimer) clearInterval(countdownTimer);
            nextRefreshAt = Date.now() + REFRESH_INTERVAL_MS;
            countdownTimer = setInterval(() => {
                const remaining = Math.max(0, nextRefreshAt - Date.now());
                const mins = Math.floor(remaining / 60000);
                const secs = Math.floor((remaining % 60000) / 1000);
                nextRefreshLabel.textContent = `Auto-refresh in ${mins}:${String(secs).padStart(2,'0')}`;
            }, 1000);
        }

        function scheduleRefresh() {
            if (refreshTimer) clearTimeout(refreshTimer);
            startCountdown();
            refreshTimer = setTimeout(async () => {
                await initializeSystem();
                scheduleRefresh();
            }, REFRESH_INTERVAL_MS);
        }

        async function manualRefresh() {
            const btn = document.getElementById('refreshBtn');
            btn.textContent = '‚ü≥ Refreshing‚Ä¶';
            btn.disabled = true;
            await initializeSystem();
            btn.textContent = '‚ü≥ Refresh';
            btn.disabled = false;
            scheduleRefresh();
        }

        // Initialize on load
        initializeSystem().then(() => scheduleRefresh());
    </script>
</body>
</html>
